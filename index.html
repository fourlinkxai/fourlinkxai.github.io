<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
  <title>Fourlinkx Photo Ai</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;600&display=swap');

    * {
      box-sizing: border-box;
    }
    body {
      margin: 0;
      font-family: 'Poppins', sans-serif;
      background: #1a1a2e;
      color: #e0e0f8;
      max-width: 350px;
      margin: 0 auto;
      padding: 20px 15px;
      display: flex;
      flex-direction: column;
      min-height: 100vh;
      overflow: hidden;
      user-select: none;
    }
    h1 {
      font-weight: 600;
      font-size: 2rem;
      margin-bottom: 8px;
      text-align: center;
      color: #6ee7ff;
      text-shadow: 0 0 6px #24aaffcc;
    }
    p {
      font-weight: 300;
      margin-top: 0;
      margin-bottom: 20px;
      text-align: center;
      font-size: 1rem;
      color: #a5b9dccc;
    }

    /* Upload input */
    .upload-container {
      border: 2px dashed #479be0cc;
      border-radius: 15px;
      padding: 30px 10px;
      text-align: center;
      cursor: pointer;
      color: #479be0cc;
      box-shadow: 0 0 10px #2a7bd9aa;
      transition: border-color 0.3s ease, color 0.3s ease;
    }
    .upload-container:hover {
      border-color: #6ee7ff;
      color: #6ee7ff;
      box-shadow: 0 0 16px #30c3ffcc;
    }
    #fileInput {
      display: none;
    }

    /* Image previews */
    .images-container {
      margin-top: 20px;
      display: flex;
      justify-content: space-around;
      gap: 10px;
      flex-wrap: nowrap;
      overflow-x: auto;
      padding-bottom: 10px;
    }
    figure {
      flex: 0 0 45%;
      margin: 0;
      text-align: center;
      background: #16213e;
      border-radius: 12px;
      box-shadow: 0 5px 15px #1f3a7aaa;
      padding: 10px;
    }
    figure img, canvas {
      max-width: 100%;
      border-radius: 10px;
      display: block;
      margin: 0 auto 8px auto;
      box-shadow: 0 4px 8px #0f255ea8;
      user-select: none;
    }
    figcaption {
      font-weight: 500;
      font-size: 0.9rem;
      color: #7fcfffcc;
    }

    /* Buttons */
    button {
      margin-top: 10px;
      display: block;
      width: 100%;
      font-weight: 600;
      padding: 12px 0;
      background: #48b1ff;
      color: #091f3f;
      border: none;
      border-radius: 16px;
      font-size: 1.1rem;
      cursor: pointer;
      box-shadow: 0 5px 15px #2887c5cc;
      transition: background-color 0.25s ease;
      user-select: none;
    }
    button:hover:not(:disabled) {
      background-color: #2a90f1;
      box-shadow: 0 6px 20px #1f6bc399;
    }
    button:disabled {
      cursor: not-allowed;
      background-color: #2e587e99;
      box-shadow: none;
      color: #a1bbd9cc;
    }

    /* Instructions */
    .instructions {
      font-size: 0.85rem;
      font-weight: 300;
      color: #9db8e0cc;
      text-align: center;
      margin-top: 10px;
      user-select: none;
    }

    /* Scrollbar for images container */
    .images-container::-webkit-scrollbar {
      height: 6px;
    }
    .images-container::-webkit-scrollbar-thumb {
      background-color: #6ee7ffcc;
      border-radius: 4px;
    }

    /* Responsive for small width */
    @media (max-width: 350px) {
      h1 {
        font-size: 1.6rem;
      }
      button {
        font-size: 1rem;
        padding: 10px 0;
      }
      .images-container {
        gap: 8px;
      }
      figure {
        flex-basis: 48%;
      }
    }
  </style>
</head>
<body>

  <h1>Fourlinkx Photo Ai</h1>
  <p>Upload your photo and see an AI-styled artistic transformation applied instantly!</p>

  <label class="upload-container" for="fileInput" tabindex="0" aria-label="Upload your photo">
    Click or tap here to upload your photo
    <input type="file" id="fileInput" accept="image/*" />
  </label>

  <div class="images-container" aria-live="polite" aria-relevant="additions removals">
    <figure id="originalFigure" hidden>
      <img id="originalImage" alt="Original uploaded photo preview" />
      <figcaption>Original Photo</figcaption>
    </figure>
    <figure id="aiFigure" hidden>
      <canvas id="aiCanvas" aria-label="AI generated image"></canvas>
      <figcaption>AI-Generated Image</figcaption>
    </figure>
  </div>

  <button id="generateBtn" disabled aria-disabled="true">Generate AI Image</button>

  <p class="instructions">
    The AI-generated image is simulated in your browser by applying artistic filters. No photo data is uploaded anywhere.
  </p>

<script>
  (function() {
    const fileInput = document.getElementById('fileInput');
    const originalImage = document.getElementById('originalImage');
    const aiCanvas = document.getElementById('aiCanvas');
    const originalFigure = document.getElementById('originalFigure');
    const aiFigure = document.getElementById('aiFigure');
    const generateBtn = document.getElementById('generateBtn');

    let img = new Image();
    let imgLoaded = false;

    function reset() {
      originalFigure.hidden = true;
      aiFigure.hidden = true;
      generateBtn.disabled = true;
      generateBtn.setAttribute('aria-disabled', 'true');
      aiCanvas.width = 0;
      aiCanvas.height = 0;
      originalImage.src = '';
      imgLoaded = false;
    }

    function loadImage(file) {
      reset();
      if (!file) return;

      const url = URL.createObjectURL(file);
      img.src = url;

      img.onload = function() {
        URL.revokeObjectURL(url);
        originalImage.src = img.src;
        originalFigure.hidden = false;
        generateBtn.disabled = false;
        generateBtn.setAttribute('aria-disabled', 'false');
        imgLoaded = true;
      };
      img.onerror = () => {
        alert("Failed to load image! Please try another file.");
        reset();
      }
    }

    // Function to apply pixelated cartoon effect
    function applyPixelatedCartoonEffect() {
      if (!imgLoaded) return;

      // Set max display width, slightly larger for generated canvas
      const maxCanvasWidth = 340;
      const scale = Math.min(1, maxCanvasWidth / img.width);
      const displayWidth = Math.floor(img.width * scale);
      const displayHeight = Math.floor(img.height * scale);

      // First, draw original image scaled to display size on offscreen canvas
      const offscreen = document.createElement('canvas');
      const offCtx = offscreen.getContext('2d');
      offscreen.width = displayWidth;
      offscreen.height = displayHeight;
      offCtx.drawImage(img, 0, 0, displayWidth, displayHeight);

      // Pixelation level (size of pixel blocks)
      const pixelSize = 12; // bigger pixel blocks for more noticeable pixelation

      // Calculate size of pixelated canvas
      const pixelCanvasWidth = Math.ceil(displayWidth / pixelSize);
      const pixelCanvasHeight = Math.ceil(displayHeight / pixelSize);

      // Create pixelated canvas to draw scaled down image
      const pixelCanvas = document.createElement('canvas');
      const pixelCtx = pixelCanvas.getContext('2d');
      pixelCanvas.width = pixelCanvasWidth;
      pixelCanvas.height = pixelCanvasHeight;

      // Draw scaled-down small pixelated image
      pixelCtx.drawImage(offscreen, 0, 0, displayWidth, displayHeight, 0, 0, pixelCanvasWidth, pixelCanvasHeight);

      // Get pixel data for cartoon effect
      const pixelImageData = pixelCtx.getImageData(0, 0, pixelCanvasWidth, pixelCanvasHeight);
      const data = pixelImageData.data;

      // Stronger color quantization (reduce colors)
      const quantizeLevel = 64; // fewer colors, more cartoonish
      for(let i = 0; i < data.length; i += 4) {
        data[i] = Math.floor(data[i] / quantizeLevel) * quantizeLevel;     // R
        data[i+1] = Math.floor(data[i+1] / quantizeLevel) * quantizeLevel; // G
        data[i+2] = Math.floor(data[i+2] / quantizeLevel) * quantizeLevel; // B
      }

      pixelCtx.putImageData(pixelImageData, 0, 0);

      // Now draw pixelated image enlarged back onto aiCanvas
      aiCanvas.width = displayWidth;
      aiCanvas.height = displayHeight;

      // Disable smoothing for crisp pixel blocks
      const ctx = aiCanvas.getContext('2d');
      ctx.imageSmoothingEnabled = false;

      ctx.clearRect(0, 0, aiCanvas.width, aiCanvas.height);
      ctx.drawImage(pixelCanvas, 0, 0, pixelCanvasWidth, pixelCanvasHeight, 0, 0, displayWidth, displayHeight);

      // Optionally overlay a subtle translucent blue tint for style
      ctx.fillStyle = 'rgba(70, 160, 255, 0.15)';
      ctx.fillRect(0, 0, aiCanvas.width, aiCanvas.height);

      // Optional: add cartoonish black outlines (simple edge detection)
      const edgeThreshold = 30;
      const imgData = ctx.getImageData(0, 0, aiCanvas.width, aiCanvas.height);
      const pixels = imgData.data;

      function rgbToGray(r, g, b) {
        return 0.299 * r + 0.587 * g + 0.114 * b;
      }

      for (let y = 1; y < aiCanvas.height - 1; y++) {
        for (let x = 1; x < aiCanvas.width - 1; x++) {
          const idx = (y * aiCanvas.width + x) * 4;
          const center = rgbToGray(pixels[idx], pixels[idx + 1], pixels[idx + 2]);
          const right = rgbToGray(pixels[idx + 4], pixels[idx + 5], pixels[idx + 6]);
          const down = rgbToGray(pixels[idx + aiCanvas.width * 4], pixels[idx + aiCanvas.width * 4 +1], pixels[idx + aiCanvas.width *4 +2]);

          const diff = Math.abs(center - right) + Math.abs(center - down);
          if(diff > edgeThreshold) {
            pixels[idx] = 20;   // black outlines strong darkening
            pixels[idx+1] = 20;
            pixels[idx+2] = 20;
            // Optional alpha enhancement for edges
            pixels[idx+3] = 255;
          }
        }
      }

      ctx.putImageData(imgData, 0, 0);

      aiFigure.hidden = false;
    }

    fileInput.addEventListener('change', e => {
      if (e.target.files.length > 0) {
        reset();
        const file = e.target.files[0];
        const url = URL.createObjectURL(file);
        img.src = url;
        img.onload = function() {
          URL.revokeObjectURL(url);
          originalImage.src = img.src;
          originalFigure.hidden = false;
          generateBtn.disabled = false;
          generateBtn.setAttribute('aria-disabled', 'false');
          imgLoaded = true;
        };
        img.onerror = () => {
          alert("Failed to load image! Please try another file.");
          reset();
        }
      }
    });

    generateBtn.addEventListener('click', () => {
      applyPixelatedCartoonEffect();
      generateBtn.blur();
    });

    // Keyboard accessibility for upload container
    const uploadContainer = document.querySelector('.upload-container');
    uploadContainer.addEventListener('keydown', e => {
      if (e.key === 'Enter' || e.key === ' ') {
        e.preventDefault();
        fileInput.click();
      }
    });

    function reset() {
      originalFigure.hidden = true;
      aiFigure.hidden = true;
      generateBtn.disabled = true;
      generateBtn.setAttribute('aria-disabled', 'true');
      aiCanvas.width = 0;
      aiCanvas.height = 0;
      originalImage.src = '';
      imgLoaded = false;
    }

    reset();
  })();
</script>
</body>
</html>

