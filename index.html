
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
<title>Fourlinkx Photo Ai</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;600&display=swap');
  * {
    box-sizing: border-box;
  }
  body {
    margin: 0;
    font-family: 'Inter', sans-serif;
    background: linear-gradient(135deg, #141e30, #243b55);
    color: #e3eafc;
    max-width: 350px;
    height: 600px;
    margin: 0 auto;
    padding: 20px 15px;
    display: flex;
    flex-direction: column;
    user-select: none;
    overflow: hidden;
  }
  h1 {
    margin: 0 0 10px 0;
    font-weight: 600;
    font-size: 2rem;
    text-align: center;
    color: #63b3ed;
    text-shadow: 0 0 6px #2c7be5cc;
  }
  p.description {
    margin: 0 0 20px 0;
    font-weight: 300;
    font-size: 1rem;
    text-align: center;
    color: #9bb7e6dd;
  }
  label.upload-label {
    border: 2px dashed #58a6ffcc;
    border-radius: 16px;
    padding: 30px 12px;
    text-align: center;
    color: #65a3ffcc;
    cursor: pointer;
    transition: border-color 0.3s, color 0.3s, background-color 0.15s;
    user-select: none;
    font-weight: 600;
    font-size: 1.1rem;
  }
  label.upload-label:hover,
  label.upload-label:focus-visible {
    border-color: #8dbdff;
    color: #8dbdff;
    background-color: rgba(55, 95, 188, 0.3);
    outline: none;
  }
  input#file-input {
    display: none;
  }
  .preview-container {
    margin-top: 20px;
    display: flex;
    gap: 12px;
    justify-content: center;
    overflow-x: auto;
    padding-bottom: 12px;
  }
  figure {
    margin: 0;
    width: 48%;
    background-color: rgba(30, 50, 100, 0.7);
    border-radius: 16px;
    padding: 12px;
    box-shadow: 0 3px 10px rgba(30, 95, 255, 0.5);
  }
  figure img,
  figure canvas {
    max-width: 100%;
    border-radius: 12px;
    box-shadow: 0 0 14px rgba(40, 110, 255, 0.6);
    display: block;
    margin: 0 auto;
  }
  figcaption {
    margin-top: 10px;
    color: #7ea9ffcc;
    font-weight: 600;
    font-size: 0.9rem;
    text-align: center;
    user-select: none;
  }
  button#generate-btn {
    margin-top: auto;
    font-weight: 700;
    font-size: 1.2rem;
    padding: 14px 0;
    border-radius: 16px;
    border: none;
    background-color: #3e7ff8;
    color: #d6e2ff;
    cursor: pointer;
    box-shadow: 0 7px 20px rgba(63, 123, 245, 0.6);
    transition: background-color 0.25s;
    user-select: none;
  }
  button#generate-btn:disabled {
    background-color: #2a4d8c88;
    cursor: not-allowed;
    box-shadow: none;
    color: #94a9ccaa;
  }
  button#generate-btn:hover:not(:disabled) {
    background-color: #2d6bdb;
    box-shadow: 0 9px 25px rgba(47, 105, 230, 0.9);
  }
  p#instruction {
    margin-top: 15px;
    font-weight: 300;
    font-size: 0.85rem;
    color: #aac3ffbb;
    text-align: center;
    user-select: none;
  }
  /* Scrollbar for preview container */
  .preview-container::-webkit-scrollbar {
    height: 6px;
  }
  .preview-container::-webkit-scrollbar-thumb {
    background-color: #7ea9ffbb;
    border-radius: 4px;
  }
  /* Mobile adjustments */
  @media (max-width: 350px) {
    h1 {
      font-size: 1.7rem;
    }
    button#generate-btn {
      font-size: 1.1rem;
      padding: 12px 0;
    }
    figure {
      width: 49%;
    }
  }

</style>
</head>
<body>
  <h1>Fourlinkx Photo Ai</h1>
  <p class="description">Upload a photo and watch your AI-stylized pixel-art transformation right here!</p>

  <label class="upload-label" for="file-input" tabindex="0" aria-label="Upload your photo or image">
    Click or tap here to upload photo
    <input type="file" id="file-input" accept="image/*" />
  </label>

  <div class="preview-container" aria-live="polite" aria-relevant="additions removals" aria-atomic="true">
    <figure id="original-figure" hidden>
      <img id="original-img" alt="Original uploaded photo preview" />
      <figcaption>Original Photo</figcaption>
    </figure>
    <figure id="ai-figure" hidden>
      <canvas id="ai-canvas" aria-label="AI generated image"></canvas>
      <figcaption>AI-Generated Image</figcaption>
    </figure>
  </div>

  <button id="generate-btn" disabled aria-disabled="true" type="button">Generate AI Image</button>

  <p id="instruction">All processing happens in your browser; your images are private and secure.</p>

<script>
  (() => {
    const fileInput = document.getElementById('file-input');
    const generateBtn = document.getElementById('generate-btn');
    const originalFigure = document.getElementById('original-figure');
    const originalImg = document.getElementById('original-img');
    const aiFigure = document.getElementById('ai-figure');
    const aiCanvas = document.getElementById('ai-canvas');
    const aiCtx = aiCanvas.getContext('2d');

    let userImg = null;

    function reset() {
      originalFigure.hidden = true;
      aiFigure.hidden = true;
      generateBtn.disabled = true;
      generateBtn.setAttribute('aria-disabled', 'true');
      aiCanvas.width = 0;
      aiCanvas.height = 0;
      originalImg.src = "";
      userImg = null;
    }

    function loadImage(file) {
      reset();
      if (!file) return;
      const url = URL.createObjectURL(file);
      const img = new Image();
      img.onload = () => {
        URL.revokeObjectURL(url);
        userImg = img;
        originalImg.src = url;
        originalFigure.hidden = false;
        generateBtn.disabled = false;
        generateBtn.setAttribute('aria-disabled', 'false');
      };
      img.onerror = () => {
        alert("Failed to load image. Please try a different one.");
        reset();
      }
      img.src = url;
    }

    function pixelateAndCartoon() {
      if (!userImg) return;
      const maxWidth = 340;
      const scale = Math.min(1, maxWidth / userImg.width);
      const width = Math.floor(userImg.width * scale);
      const height = Math.floor(userImg.height * scale);

      // Draw scaled down image on offscreen canvas
      const offCanvas = document.createElement('canvas');
      const offCtx = offCanvas.getContext('2d');
      offCanvas.width = width;
      offCanvas.height = height;
      offCtx.drawImage(userImg, 0, 0, width, height);

      // Pixelation block size
      const blockSize = 10;

      // Calculate low res dimensions for pixelation
      const pixelWidth = Math.ceil(width / blockSize);
      const pixelHeight = Math.ceil(height / blockSize);

      // Create pixel canvas
      const pixelCanvas = document.createElement('canvas');
      const pixelCtx = pixelCanvas.getContext('2d');
      pixelCanvas.width = pixelWidth;
      pixelCanvas.height = pixelHeight;

      // Draw scaled-down image to create pixelation effect
      pixelCtx.drawImage(offCanvas, 0, 0, width, height, 0, 0, pixelWidth, pixelHeight);

      // Strong color quantization for cartoon look
      const imageData = pixelCtx.getImageData(0, 0, pixelWidth, pixelHeight);
      const data = imageData.data;
      const quantLevel = 64;

      for (let i = 0; i < data.length; i += 4) {
        data[i] = Math.floor(data[i] / quantLevel) * quantLevel;
        data[i+1] = Math.floor(data[i+1] / quantLevel) * quantLevel;
        data[i+2] = Math.floor(data[i+2] / quantLevel) * quantLevel;
      }
      pixelCtx.putImageData(imageData, 0, 0);

      // Resize canvas to full display with no smoothing (sharp pixel blocks)
      aiCanvas.width = width;
      aiCanvas.height = height;
      aiCtx.imageSmoothingEnabled = false;
      aiCtx.clearRect(0, 0, width, height);
      aiCtx.drawImage(pixelCanvas, 0, 0, pixelWidth, pixelHeight, 0, 0, width, height);

      // Add subtle bluish overlay for style
      aiCtx.fillStyle = 'rgba(60, 120, 255, 0.12)';
      aiCtx.fillRect(0, 0, width, height);

      // Edge detection for cartoon outlines
      const imgData = aiCtx.getImageData(0, 0, width, height);
      const pix = imgData.data;

      function grayscale(r, g, b) {
        return 0.299 * r + 0.587 * g + 0.114 * b;
      }

      const threshold = 30;
      for (let y = 1; y < height - 1; y++) {
        for (let x = 1; x < width - 1; x++) {
          const idx = (y * width + x) * 4;
          const center = grayscale(pix[idx], pix[idx+1], pix[idx+2]);
          const right = grayscale(pix[idx+4], pix[idx+5], pix[idx+6]);
          const down = grayscale(pix[idx + width*4], pix[idx + width*4 +1], pix[idx + width*4 +2]);
          if (Math.abs(center - right) + Math.abs(center - down) > threshold) {
            pix[idx] = 20;
            pix[idx + 1] = 20;
            pix[idx + 2] = 20;
            pix[idx + 3] = 255;
          }
        }
      }
      aiCtx.putImageData(imgData, 0, 0);

      aiFigure.hidden = false;
    }

    fileInput.addEventListener('change', e => {
      if (e.target.files.length > 0) {
        loadImage(e.target.files[0]);
      }
    });

    generateBtn.addEventListener('click', () => {
      pixelateAndCartoon();
      generateBtn.blur();
    });

    // Accessibility: keyboard trigger upload dialog on label focus + enter/space
    const uploadLabel = document.querySelector('label.upload-label');
    uploadLabel.addEventListener('keydown', e => {
      if (e.key === 'Enter' || e.key === ' ') {
        e.preventDefault();
        fileInput.click();
      }
    });

    reset();

  })();
</script>

</body>
</html>
