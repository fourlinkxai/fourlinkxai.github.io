<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
<title>Fourlinkx Real-Time Chat App</title>
<style>
  * {
    box-sizing: border-box;
  }
  body {
    margin: 0; padding: 0;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: #f4f7fa;
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
  }
  #app {
    display: flex;
    flex-direction: column;
    width: 350px;
    height: 600px;
    background: white;
    border-radius: 12px;
    box-shadow: 0 12px 24px rgba(0,0,0,0.15);
    overflow: hidden;
  }
  header {
    background: #3f51b5;
    color: white;
    font-weight: 700;
    font-size: 1.3rem;
    padding: 15px 20px;
    text-align: center;
    user-select: none;
  }
  #chat-container {
    flex: 1;
    display: flex;
    flex-direction: column;
    background: #e8ebf4;
  }
  #messages {
    flex: 1;
    padding: 15px 20px;
    overflow-y: auto;
    display: flex;
    flex-direction: column;
    gap: 10px;
  }
  .message {
    max-width: 75%;
    padding: 10px 14px;
    border-radius: 20px;
    font-size: 0.95rem;
    line-height: 1.3;
    word-wrap: break-word;
    white-space: pre-wrap;
  }
  .message.system {
    color: #888;
    font-style: italic;
    text-align: center;
    max-width: 100%;
    background: transparent;
    border-radius: 0;
    padding: 6px 0;
  }
  .message.self {
    background: #3f51b5;
    color: white;
    align-self: flex-end;
    border-bottom-right-radius: 4px;
  }
  .message.other {
    background: white;
    color: #222;
    align-self: flex-start;
    box-shadow: 0 1px 4px rgba(0,0,0,0.1);
    border-bottom-left-radius: 4px;
  }
  #input-area {
    display: flex;
    background: white;
    border-top: 1px solid #ccc;
  }
  #input {
    flex: 1;
    border: none;
    padding: 12px 16px;
    font-size: 1rem;
    border-radius: 0;
    outline: none;
  }
  #send-btn {
    background: #3f51b5;
    color: white;
    border: none;
    padding: 0 20px;
    cursor: pointer;
    font-weight: 700;
    font-size: 1rem;
    user-select: none;
    transition: background-color 0.3s ease;
  }
  #send-btn:hover {
    background: #303f9f;
  }
  #status {
    font-size: 0.9rem;
    color: #555;
    font-style: italic;
    text-align: center;
    padding: 8px 12px;
    background: #f0f2f8;
    border-bottom: 1px solid #ccc;
  }
  @media screen and (max-width: 400px) {
    #app {
      width: 95vw;
      height: 95vh;
      max-width: 350px;
      max-height: 600px;
      border-radius: 0;
      box-shadow: none;
    }
  }
</style>
</head>
<body>
<div id="app" role="main" aria-label="Real-Time Chat Application">
  <header>Fourlinkx Real-Time Chat App</header>
  <div id="status" aria-live="polite" aria-atomic="true">Connecting...</div>
  <div id="chat-container">
    <div id="messages" aria-live="polite" aria-relevant="additions" role="log"></div>
    <form id="input-area" aria-label="Send message">
      <input type="text" id="input" placeholder="Type your message..." autocomplete="off" aria-label="Message input" required />
      <button type="submit" id="send-btn" aria-label="Send message">Send</button>
    </form>
  </div>
</div>

<!-- Socket.io client CDN -->
<script src="https://cdn.socket.io/4.7.2/socket.io.min.js" integrity="sha384-Rp+3mNi4mhkHH2gVrZ6QQ9mK9Qi9MT6E07tdib8GZf7eYl82zw+fN3N3ktnfY+Rd" crossorigin="anonymous"></script>
<script>
  (function(){
    // Change this URL to your deployed backend socket.io server URL
    const SOCKET_IO_SERVER_URL = "https://your-app-name.up.railway.app"; // <-- EDIT THIS!

    const statusEl = document.getElementById('status');
    const messagesEl = document.getElementById('messages');
    const formEl = document.getElementById('input-area');
    const inputEl = document.getElementById('input');

    let socket;
    let connected = false;

    // Prompt nickname once
    let nickname = prompt("Enter your nickname:", "User" + Math.floor(Math.random() * 1000)) || "User";

    // Add system message
    function addSystemMessage(msg) {
      const div = document.createElement('div');
      div.classList.add('message', 'system');
      div.textContent = msg;
      messagesEl.appendChild(div);
      messagesEl.scrollTo({ top: messagesEl.scrollHeight, behavior: 'smooth' });
    }

    // Add chat message
    function addChatMessage(msg, isSelf) {
      const div = document.createElement('div');
      div.classList.add('message');
      div.classList.add(isSelf ? 'self' : 'other');
      div.textContent = msg;
      messagesEl.appendChild(div);
      messagesEl.scrollTo({ top: messagesEl.scrollHeight, behavior: 'smooth' });
    }

    function connect() {
      statusEl.textContent = 'Connecting...';
      socket = io(SOCKET_IO_SERVER_URL);

      socket.on('connect', () => {
        connected = true;
        statusEl.textContent = 'Connected as "' + nickname + '".';
        socket.emit('set-nickname', nickname);
        addSystemMessage('You joined the chat.');
        inputEl.focus();
      });

      socket.on('disconnect', () => {
        connected = false;
        statusEl.textContent = 'Disconnected.';
        addSystemMessage('You left the chat.');
      });

      socket.on('connect_error', (err) => {
        statusEl.textContent = 'Connection error: ' + err.message;
      });

      socket.on('chat message', data => {
        // data format: { sender: string, msg: string }
        const isSelf = data.sender === nickname;
        const displayName = isSelf ? "Me" : data.sender;
        addChatMessage(displayName + ': ' + data.msg, isSelf);
      });
    }

    formEl.addEventListener('submit', function(e){
      e.preventDefault();
      if (!connected) {
        alert('Not connected to chat server.');
        return;
      }
      const msg = inputEl.value.trim();
      if (!msg) return;
      socket.emit('chat message', msg);
      inputEl.value = '';
      inputEl.focus();
    });

    connect();
  })();
</script>
</body>
</html>

